# Use with VS Code REST Client extension or IntelliJ HTTP Client
#
# Webhook requests require HMAC-SHA256 signatures.
# Run: pnpm requests:init to compute and populate the signature in .env

@baseUrl = http://localhost:3500
@tunnelUrl = https://darrenchay.mappedin.io
@ticketKey = SRV-3244
@botName = mapthew
@jiraSignature = {{$dotenv REQUESTS_HTTP_JIRA_WEBHOOK_SIGNATURE}}

### Health Check
GET {{baseUrl}}/health

###############################################
# JIRA Webhooks (require X-Hub-Signature-256)
###############################################

### Trigger Bot Workflow (simulated JIRA comment)
POST {{baseUrl}}/webhook/jira
Content-Type: application/json
X-Hub-Signature-256: sha256={{jiraSignature}}

{
  "webhookEvent": "comment_created",
  "comment": {
    "body": "@{{botName}} implement the change described in this ticket",
    "author": { "displayName": "Test Developer" }
  },
  "issue": { "key": "{{ticketKey}}" }
}

###############################################
# Cloudflare Tunnel Tests (run: pnpm tunnel)
###############################################

### Test tunnel connection
POST {{tunnelUrl}}/webhook/jira
Content-Type: application/json
X-Hub-Signature-256: sha256={{jiraSignature}}

{
  "webhookEvent": "comment_created",
  "comment": {
    "body": "Test cloudflare tunnel, {{botName}} should ignore this",
    "author": { "displayName": "Tunnel Test" }
  },
  "issue": { "key": "{{ticketKey}}" }
}

###############################################
# Sessions API
###############################################

### List all sessions
GET {{baseUrl}}/api/sessions

### Get session stats
GET {{baseUrl}}/api/sessions/stats

### Delete a specific session
DELETE {{baseUrl}}/api/sessions/DXTR-123

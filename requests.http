# Use with VS Code REST Client extension or IntelliJ HTTP Client
#
# Webhook signatures are optional for local testing (when JIRA_WEBHOOK_SECRET is not set).
# In production, set JIRA_WEBHOOK_SECRET to require signature verification.

@baseUrl = http://localhost:3000
@tunnelUrl = https://ben.mappedin.io
@ticketKey = DXTR-3
@botName = mapthew

### Health Check
GET {{baseUrl}}/health

### Trigger Bot Workflow (simulated JIRA comment)
POST {{baseUrl}}/webhook/jira
Content-Type: application/json

{
  "webhookEvent": "comment_created",
  "comment": {
    "body": "@{{botName}} implement the change described in this ticket",
    "author": { "displayName": "Test Developer" }
  },
  "issue": { "key": "{{ticketKey}}" }
}

### Non-bot comment (should be ignored)
POST {{baseUrl}}/webhook/jira
Content-Type: application/json

{
  "webhookEvent": "comment_created",
  "comment": {
    "body": "This is a regular comment without the trigger",
    "author": { "displayName": "Product Manager" }
  },
  "issue": { "key": "{{ticketKey}}" }
}

### Non-comment event (should be ignored)
POST {{baseUrl}}/webhook/jira
Content-Type: application/json

{
  "webhookEvent": "issue_updated",
  "comment": {
    "body": "@{{botName}} this won't trigger because event type is wrong",
    "author": { "displayName": "Test Developer" }
  },
  "issue": { "key": "{{ticketKey}}" }
}

###############################################
# Cloudflare Tunnel Tests (run: pnpm tunnel)
###############################################

### Test tunnel connection
POST {{tunnelUrl}}/webhook/jira
Content-Type: application/json

{
  "webhookEvent": "comment_created",
  "comment": {
    "body": "Test cloudflare tunnel, {{botName}} should ignore this",
    "author": { "displayName": "Tunnel Test" }
  },
  "issue": { "key": "{{ticketKey}}" }
}
